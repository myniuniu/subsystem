{"version":3,"mappings":"wCAGA,IAAIA,EAAkB,IAAI,IACtBC,EAAe,KAGnB,MAAMC,EAAkB,SAAY,CAClC,GAAI,CAACD,EAAc,CACjB,KAAM,CAAE,KAAAE,GAAS,MAAMC,EAAA,WAAO,qBAAoB,OAAAC,KAAA,IAAC,0DACnDJ,EAAeE,CAChB,CACD,OAAOF,CACT,EAGaK,EAAsB,SAAY,CAC7C,MAAMC,EAAU,UAGhB,GAAI,CAAAP,EAAgB,IAAIO,CAAO,EAI/B,GAAI,CACF,MAAMJ,EAAO,MAAMD,EAAiB,EAEpC,MAAMM,CAAY,CAChB,aAAc,CACZ,KAAK,MAAQ,OACb,KAAK,QAAU,u9BACf,KAAK,IAAM,QACZ,CAED,SAASC,EAAQ,CACf,MAAO,EACR,CAED,SAASA,EAAQ,CACf,MAAO,EACR,CAED,WAAWA,EAAQ,CACjB,MAAMC,EAAeD,EAAO,iBAAkB,EAC9C,MAAO,CAACC,GAAgBA,EAAa,KAAM,IAAK,EACjD,CAED,KAAKD,EAAQE,EAAO,CAClB,GAAI,KAAK,WAAWF,CAAM,EAAG,CAE3BL,EAAA,WAAO,qBAAM,EAAC,qFAAC,KAAK,CAAC,CAAE,QAAAQ,CAAO,IAAO,CACnCA,EAAQ,QAAQ,YAAY,CACxC,CAAW,EACD,MACD,CAED,MAAMF,EAAeD,EAAO,iBAAkB,EAC9C,GAAIC,GAAgBA,EAAa,OAAQ,CAEvC,MAAMG,EAAc,OAAO,UAAU,EACrC,GAAIA,GAAeA,EAAY,OAAQ,CAErC,MAAMC,EAAc,6GAA6GD,CAAW,KAAKH,CAAY,UAC7JD,EAAO,sBAAsBK,CAAW,EACxCV,EAAA,WAAO,qBAAM,uFAAE,KAAK,CAAC,CAAE,QAAAQ,CAAO,IAAO,CACnCA,EAAQ,QAAQ,QAAQ,CACtC,CAAa,CACF,CACF,CACF,CACF,CAGDT,EAAK,aAAa,CAChB,IAAKI,EACL,SAAU,CACR,OAAO,IAAIC,CACZ,CACP,CAAK,EAEDR,EAAgB,IAAIO,CAAO,EAC3B,QAAQ,IAAI,UAAU,CAEvB,OAAQQ,EAAO,CAEd,GAAIA,EAAM,SAAWA,EAAM,QAAQ,SAAS,gBAAgB,EAC1Df,EAAgB,IAAIO,CAAO,EAC3B,QAAQ,IAAI,cAAc,MAE1B,eAAQ,MAAM,YAAaQ,CAAK,EAC1BA,CAET,CACH,EAGaC,EAAoB,IAAM,CACrChB,EAAgB,MAAO,EACvBC,EAAe,IACjB","names":["registeredMenus","bootInstance","getBootInstance","Boot","__vitePreload","n","registerCommentMenu","menuKey","CommentMenu","editor","selectedText","value","message","commentText","commentHtml","error","clearMenuRegistry"],"sources":["../../src/utils/editorMenuRegistry.js"],"sourcesContent":["// 全局编辑器菜单注册管理器\n// 避免多个组件重复注册相同的wangEditor菜单\n\nlet registeredMenus = new Set()\nlet bootInstance = null\n\n// 获取Boot实例\nconst getBootInstance = async () => {\n  if (!bootInstance) {\n    const { Boot } = await import('@wangeditor/editor')\n    bootInstance = Boot\n  }\n  return bootInstance\n}\n\n// 注册评论菜单（全局单例）\nexport const registerCommentMenu = async () => {\n  const menuKey = 'comment'\n  \n  // 如果已经注册过，直接返回\n  if (registeredMenus.has(menuKey)) {\n    return\n  }\n  \n  try {\n    const Boot = await getBootInstance()\n    \n    class CommentMenu {\n      constructor() {\n        this.title = '添加评论'\n        this.iconSvg = `<svg viewBox=\"0 0 1024 1024\"><path d=\"M573 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40zM293 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40zM433 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z\"/><path d=\"M894 345c-48.1-66-115.3-110.1-189-130v.1c-17.1-19-36.4-36.5-58-52.1-163.7-119-393.5-82.7-513 81-96.3 133-92.2 311.9 6 439l.8 132.6c0 3.2.5 6.4 1.5 9.4 5.3 16.9 23.3 26.2 40.1 20.9L309 806c33.5 11.9 68.1 18.7 102.5 20.6l-.5.4c89.1 64.9 205.9 84.4 313 49l127.8 41.4c3.2 1 6.5 1.6 9.9 1.6 17.7 0 32-14.3 32-32V753.8c88.1-119.6 90.4-284.9 1-408.8zM323 735l-12-5-99 31-1-104-8-9c-84.6-103.2-90.2-251.9-11-361 96.4-132.2 281.2-161.4 413-66 132.2 96.1 161.5 280.6 66 412-80.1 109.9-204.5 150.5-348 102zm505 17l-8 10 1 104-99-31-12 5c-56 20.8-115.7 22.5-171 7l-.2-.1C613.7 829.9 680.7 798.6 734 734c96.1-115.3 92.3-281.9-8-389 138.8-35.2 274.9 32.9 339 154 65.8 123.8 60.5 259.8 14 364z\"/></svg>`\n        this.tag = 'button'\n      }\n\n      getValue(editor) {\n        return ''\n      }\n\n      isActive(editor) {\n        return false\n      }\n\n      isDisabled(editor) {\n        const selectedText = editor.getSelectionText()\n        return !selectedText || selectedText.trim() === ''\n      }\n\n      exec(editor, value) {\n        if (this.isDisabled(editor)) {\n          // 动态导入message以避免循环依赖\n          import('antd').then(({ message }) => {\n            message.warning('请先选中要评论的文本')\n          })\n          return\n        }\n        \n        const selectedText = editor.getSelectionText()\n        if (selectedText && selectedText.trim()) {\n          // 弹出评论输入框\n          const commentText = prompt('请输入评论内容：')\n          if (commentText && commentText.trim()) {\n            // 在选中文本后添加评论标记\n            const commentHtml = `<span style=\"background-color: #fff3cd; border-bottom: 2px solid #ffc107; position: relative;\" title=\"评论: ${commentText}\">${selectedText}</span>`\n            editor.dangerouslyInsertHtml(commentHtml)\n            import('antd').then(({ message }) => {\n              message.success('评论添加成功')\n            })\n          }\n        }\n      }\n    }\n\n    // 注册菜单\n    Boot.registerMenu({\n      key: menuKey,\n      factory() {\n        return new CommentMenu()\n      }\n    })\n    \n    registeredMenus.add(menuKey)\n    console.log('评论菜单注册成功')\n    \n  } catch (error) {\n    // 如果菜单已经注册过，忽略错误\n    if (error.message && error.message.includes('Duplicated key')) {\n      registeredMenus.add(menuKey)\n      console.log('评论菜单已存在，跳过注册')\n    } else {\n      console.error('注册评论菜单失败:', error)\n      throw error\n    }\n  }\n}\n\n// 清理注册状态（用于测试或重置）\nexport const clearMenuRegistry = () => {\n  registeredMenus.clear()\n  bootInstance = null\n}"],"file":"assets/editorMenuRegistry-17788824.js"}